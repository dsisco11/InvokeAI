{
	"name": "InvokeAI::Dev",
	// "dockerComposeFile": "../docker/docker-compose.yml",
	// "service": "invokeai",
	"image": "local/invokeai:latest",
	"mounts": [
		{// Insert the devcontainers vscode settings into the container
			"type": "bind",
			"source": "${localWorkspaceFolder}/.devcontainer/.vscode/",
			"target": "${containerWorkspaceFolder}/.vscode/"
		},
		{// Replace the invokeai folder in the container with the one on the host machine
			"type": "bind",
			"source": "${localWorkspaceFolder}/invokeai",
			"target": "/opt/invokeai/invokeai"
		},
		{// Setup a volume for the pnpm-store
			"type": "volume",
			"source": "pnpm-store",
			"target": "/pnpm/store"
		},
		{// Setup a volume for the pip cache
			"type": "volume",
			"source": "pip-cache",
			"target": "/root/.cache/pip"
		},
		{// Setup a volume for the invokeai data (to prevent development work from corrupting users stable invokeai data)
			"type": "volume",
			"source": "invokeai-data-dev",
			"target": "/invokeai"
		}
	],
	"containerEnv": {
		"INVOKEAI_ROOT": "/invokeai"
	},
	"features": {
		"ghcr.io/devcontainers-contrib/features/pnpm": {
			"version": "latest"
		},
		"ghcr.io/devcontainers/features/python": {
			"version": "3.9"
		},
		"ghcr.io/devcontainers/features/nvidia-cuda": {
			"installCudnn": "true"
		}
	},
	"hostRequirements": {
		"gpu": "optional",
		"cpus": 1,
		"memory": "8gb",
		"storage": "4gb"
	},
	"forwardPorts": [80, 9090],
	"portsAttributes": {
		"80": {"label": "InvokeAI Frontend"},
		"9090": {"label": "InvokeAI Backend"}
	},
	"init": true, // Helps prevent zombie processes & stops the normal startup command for the image from running.
	// "postCreateCommand": "code /workspace/InvokeAI/.devcontainer/InvokeAI.code-workspace",
	"postAttachCommand": {
		// "Open Workspace": ["code /workspace/InvokeAI/.devcontainer/InvokeAI.code-workspace"],
		"Frontend::Install": ["cd /invokeai/frontend/web && pnpm install --reporter=append-only"], // Have to use the 'append-only' reporter or else the container will freeze during install (pretty consistently)
		// "Frontend::Install": "cd ${containerWorkspaceFolder}/invokeai/frontend/web && pnpm install --reporter=append-only", // Have to use the 'append-only' reporter or else the container will freeze during install (pretty consistently)
		// "Backend::Install": "cd ${containerWorkspaceFolder} && pip install \".[dev,test]\"",
	},
	"customizations": {
		"vscode": {
			"extensions": [
				"eamodio.gitlens",
				"ms-toolsai.jupyter",
				"ms-toolsai.vscode-jupyter-cell-tags",
				"ms-toolsai.jupyter-renderers",
				"ms-toolsai.vscode-jupyter-slideshow",
				"charliermarsh.ruff",
				"esbenp.prettier-vscode",
				"fabiospampinato.vscode-todo-plus",
				"DavidAnson.vscode-markdownlint",
				"antfu.vite"
			]
		}
	}
}
